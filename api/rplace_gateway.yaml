swagger: '2.0'
info:
  title: rplace API
  description: API Gateway pour le projet rplace
  version: 1.0.0
schemes:
  - https
produces:
  - application/json
paths:
  /discord/interactions:
    post:
      summary: Point d'entrée pour les Webhooks Discord
      operationId: discord-interactions
      x-google-backend:
        address: https://discord-proxy-458258130383.europe-west1.run.app
        deadline: 3.0
      responses:
        '200':
          description: Acknowledge sent
        '401':
          description: Invalid Signature

  /web/api/draw-pixel:
    options:
      summary: CORS preflight pour draw-pixel
      operationId: draw-pixel-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    post:
      summary: Placer un pixel sur la toile (asynchrone)
      operationId: draw-pixel
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Event published to Pub/Sub

  /web/api/retrieve-canvas:
    options:
      summary: CORS preflight pour retrieve-canvas
      operationId: retrieve-canvas-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    get:
      summary: Récupérer l'état actuel de la toile (synchrone)
      operationId: retrieve-canvas
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Canvas image or data returned

  /web/api/session/start:
    options:
      summary: CORS preflight pour session start
      operationId: session-start-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    post:
      summary: Démarrer une session (administrateur)
      operationId: session-start
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Session started

  /web/api/session/pause:
    options:
      summary: CORS preflight pour session pause
      operationId: session-pause-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    post:
      summary: Mettre en pause une session
      operationId: session-pause
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Session paused

  /web/api/session/reset:
    options:
      summary: CORS preflight pour session reset
      operationId: session-reset-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    post:
      summary: Réinitialiser la toile
      operationId: session-reset
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Canvas reset

  /web/api/session/snapshot:
    options:
      summary: CORS preflight pour session snapshot
      operationId: session-snapshot-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
    get:
      summary: Créer une capture d'écran
      operationId: session-snapshot
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: Snapshot URL returned

  /web/api/discord/oauth2/@me:
    options:
      summary: CORS preflight pour discord oauth2
      operationId: discord-oauth2-me-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
          headers:
            Access-Control-Allow-Origin:
              type: string
            Access-Control-Allow-Methods:
              type: string
            Access-Control-Allow-Headers:
              type: string
    get:
      summary: Proxy pour récupérer les informations utilisateur Discord
      operationId: discord-oauth2-me
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: User data returned
          headers:
            Access-Control-Allow-Origin:
              type: string
        '401':
          description: Invalid Discord Token

  /web/api/discord/users/@me:
    options:
      summary: CORS preflight pour discord users
      operationId: discord-users-me-cors
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '204':
          description: CORS preflight response
          headers:
            Access-Control-Allow-Origin:
              type: string
            Access-Control-Allow-Methods:
              type: string
            Access-Control-Allow-Headers:
              type: string
    get:
      summary: Proxy pour récupérer les informations utilisateur Discord (alternative)
      operationId: discord-users-me
      security:
        - api_key: []
      x-google-backend:
        address: https://web-proxy2-458258130383.europe-west1.run.app
        path_translation: APPEND_PATH_TO_ADDRESS
      responses:
        '200':
          description: User data returned
          headers:
            Access-Control-Allow-Origin:
              type: string
        '401':
          description: Invalid Discord Token

# Définition de sécurité basique (API Key ou Custom)
# Note: GCP Gateway valide nativement JWT/Firebase/Auth0.
# Avec un token opaque Discord (Implicit Grant), la validation finale se fera
# souvent dans le proxy, mais on définit ici que l'endpoint est sécurisé.
securityDefinitions:
  api_key:
    type: "apiKey"
    name: "X-API-KEY"
    in: "header"